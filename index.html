<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ETH/USDT 15 分钟监控</title>
  <style>
    :root{--bg:#0b0f16;--card:#141b25;--good:#22c55e;--bad:#f43f5e;--ink:#e5e7eb;--muted:#93a3b8;}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"PingFang SC";}
    header{padding:18px 16px;border-bottom:1px solid #22324a}
    .title{font-size:28px;font-weight:900}
    .sub{opacity:.7;margin-left:8px}
    .wrap{max-width:860px;margin:0 auto}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .row-end{margin-left:auto;opacity:.75}
    .card{background:var(--card);border:1px solid #22324a;border-radius:12px;padding:14px 16px;box-shadow:0 1px 6px rgba(0,0,0,.2)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .muted{color:var(--muted);font-size:12px}
    .signal{font-size:18px;line-height:1.5}
    .ok{color:var(--good)} .no{color:var(--bad)}
    .chip{background:#1a2333;border:1px solid #24324a;color:#8ab4ff;border-radius:999px;padding:3px 10px}
    .footer{opacity:.7;text-align:center;padding:24px 16px}
  </style>
</head>
<body>
<header>
  <div class="wrap row">
    <div class="title">ETH/USDT <span class="sub">15 分钟监控</span></div>
    <div class="row-end chip">下一次拉取： <span id="next" class="mono">--:--</span></div>
  </div>
</header>

<div class="wrap" style="margin-top:14px;">
  <div id="panel" class="card">等待生成第一次状态…</div>
  <div class="muted" style="margin-top:10px;">
    说明：云端脚本每分钟检查；只在新收盘K数出现时计算；只在状态变化（可开↔不可开）时推送到 ntfy。
  </div>
</div>

<div class="footer">© ETH15m Monitor</div>

<script>
async function load(){
  try{
    const r = await fetch('status.json?_=' + Date.now(), { cache:'no-store' });
    if(!r.ok) throw new Error('status.json not found');
    const s = await r.json();

    const title = s.ok ? '✅ 可开双向' : '❌ 暂不建议';
    const cls = s.ok ? 'ok' : 'no';
    const html = `
      <div class="signal ${cls}"><strong>${title}</strong>  |  <strong>ETH</strong>  |  <span class="muted">最近检测：${s.last_check_iso || '-'}</span></div>
      <div class="row mono">收盘(UTC)： ${s.last_candle_iso || '-'}</div>
      <div class="row mono">当前价=${(+s.price).toFixed(2)}， EMA34=${(+s.ema34).toFixed(2)}， EMA144=${(+s.ema144).toFixed(2)}</div>
      <div class="row mono">均线距离： ${(s.dist34*100).toFixed(3)}%  /  ${(s.dist144*100).toFixed(3)}%</div>
      <div class="row mono">斜率(10根)： ${(s.slope34*100).toFixed(3)}%  /  ${(s.slope144*100).toFixed(3)}%</div>
      <div class="row">对冲 Meme 选择： <span class="mono">${s.meme || '-'}</span></div>
      <div class="muted" style="margin-top:8px;">规则：ETH 止损 6% ，止盈 10% ；Meme：止损 10% ，止盈 10% ；+8% 先移动保本；+15% 启用 2% 移动止盈。</div>
    `;
    document.getElementById('panel').innerHTML = html;
  }catch(e){
    document.getElementById('panel').innerHTML = '<div class="muted">等待生成一次状态…</div>';
  }
}
load();
setInterval(load, 30000); // 每 30s 刷新页面展示

// 简单 15m 倒计时（仅展示）
(function(){
  const el = document.getElementById('next');
  function tick(){
    const now = Date.now();
    const m15 = 15*60*1000;
    const rem = m15 - (now % m15);
    const s = Math.floor(rem/1000)%60;
    const m = Math.floor(rem/60000);
    el.textContent = (m+'').padStart(2,'0')+':'+(s+'').padStart(2,'0');
  }
  tick();
  setInterval(tick, 1000);
})();
</script>
</body>
</html>
